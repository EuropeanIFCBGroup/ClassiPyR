# ClassiPyR

[![Lifecycle:
experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![R-CMD-check](https://github.com/EuropeanIFCBGroup/ClassiPyR/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/EuropeanIFCBGroup/ClassiPyR/actions/workflows/R-CMD-check.yaml)
[![codecov](https://codecov.io/gh/EuropeanIFCBGroup/ClassiPyR/branch/main/graph/badge.svg)](https://app.codecov.io/gh/EuropeanIFCBGroup/ClassiPyR)
[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.18414999.svg)](https://doi.org/10.5281/zenodo.18414999)

A Shiny application for manual (human) image classification and
validation of Imaging FlowCytobot (IFCB) plankton images. Built for
researchers who need to validate automated classifications or create
training datasets for machine learning classifiers.

**Full documentation:**
[europeanifcbgroup.github.io/ClassiPyR](https://europeanifcbgroup.github.io/ClassiPyR/)

## Background

`ClassiPyR` was created to provide a lightweight, standalone annotation
and validation tool that is fully compatible with the
[ifcb-analysis](https://github.com/hsosik/ifcb-analysis) toolbox and
custom classifiers (e.g. a CNN). The primary design goals were
user-friendliness and portability—enabling researchers to work with IFCB
data without complex setup requirements or dependencies on specific
computing environments (other than Python and R). To achieve these goals
efficiently, [Claude Code](https://code.claude.com/) was used for
development.

## Features

- **Dual Mode**: Validate existing classifications or annotate from
  scratch
- **Multiple Formats**: Load from CSV or MATLAB classifier output
- **SQLite Storage**: Annotations stored in a local SQLite database by
  default - no Python needed
- **Efficient Workflow**: Drag-select, batch relabeling, class filtering
- **MATLAB Compatible**: Optional `.mat` export for
  [ifcb-analysis](https://github.com/hsosik/ifcb-analysis) toolbox
- **CNN Training Ready**: Organized PNG output by class
- **Measure Tool**: Built-in ruler for image measurements
- **Cross-Platform**: Works on all platforms with no external
  dependencies

## Installation

Install the latest release from GitHub using the `remotes` package:

``` r
# Install remotes
if (!requireNamespace("remotes", quietly = TRUE)) install.packages("remotes")

# Install ClassiPyR
remotes::install_github("EuropeanIFCBGroup/ClassiPyR",
                        ref = remotes::github_release())
```

`ClassiPyR` depends on
[iRfcb](https://github.com/EuropeanIFCBGroup/iRfcb) for IFCB data
handling, which is installed automatically.

### Python Setup (optional)

Python is **not required** for the default workflow. Annotations are
stored in a local SQLite database that works out of the box.

Python is only needed if you want to export annotations as MATLAB `.mat`
files for use with
[ifcb-analysis](https://github.com/hsosik/ifcb-analysis). To set up
using `iRfcb`:

``` r
library(iRfcb)

# Define a path were the venv will be installed
venv_path = "/path/to/your/venv"

# Install the venv
ifcb_py_install(venv_path)
```

## Quick Start

``` r
library(ClassiPyR)
run_app()

# Or specify a Python virtual environment (takes priority over saved settings)
run_app(venv_path = venv_path)
```

See the [Getting
Started](https://europeanifcbgroup.github.io/ClassiPyR/articles/getting-started.html)
guide for detailed setup instructions.

## Documentation

- [Getting
  Started](https://europeanifcbgroup.github.io/ClassiPyR/articles/getting-started.html) -
  First-time setup
- [User
  Guide](https://europeanifcbgroup.github.io/ClassiPyR/articles/user-guide.html) -
  Complete feature reference
- [Class List
  Management](https://europeanifcbgroup.github.io/ClassiPyR/articles/class-management.html) -
  Managing classes for ifcb-analysis
- [FAQ &
  Troubleshooting](https://europeanifcbgroup.github.io/ClassiPyR/articles/faq.html) -
  Common issues

## Citation

``` r
citation("ClassiPyR")
```

## License

MIT License - see
[LICENSE](https://europeanifcbgroup.github.io/ClassiPyR/LICENSE) file.

## Disclaimer

This software is provided for research and educational purposes. Users
are responsible for their data and annotations. Always maintain backups
of your original data.

This package was partly developed with the assistance of [Claude
Code](https://code.claude.com/), an AI programming assistant by
Anthropic.

# Package index

## Running the App

Functions for launching ClassiPyR

- [`run_app()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/run_app.md)
  : Run the ClassiPyR Shiny Application
- [`init_python_env()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/init_python_env.md)
  : Initialize Python environment for iRfcb
- [`get_config_dir()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/get_config_dir.md)
  : Get ClassiPyR configuration directory
- [`get_settings_path()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/get_settings_path.md)
  : Get path to settings file

## Sample Loading

Functions for loading classifications and samples

- [`load_class_list()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/load_class_list.md)
  : Load class list from MAT or TXT file
- [`load_from_classifier_mat()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/load_from_classifier_mat.md)
  : Load classifications from MATLAB classifier output file
- [`load_from_csv()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/load_from_csv.md)
  : Load classifications from CSV file (validation mode)
- [`load_from_mat()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/load_from_mat.md)
  : Load classifications from existing MAT annotation file
- [`load_from_db()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/load_from_db.md)
  : Load classifications from SQLite database
- [`create_new_classifications()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/create_new_classifications.md)
  : Create new classifications for annotation mode
- [`filter_to_extracted()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/filter_to_extracted.md)
  : Filter classifications to only include extracted images

## Sample Saving

Functions for saving annotations and exporting images

- [`save_sample_annotations()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/save_sample_annotations.md)
  : Save sample annotations
- [`save_validation_statistics()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/save_validation_statistics.md)
  : Save validation statistics to CSV files
- [`copy_images_to_class_folders()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/copy_images_to_class_folders.md)
  : Copy images to class-organized folders

## Database Backend

SQLite database functions for annotation storage

- [`get_default_db_dir()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/get_default_db_dir.md)
  : Get default database directory
- [`get_db_path()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/get_db_path.md)
  : Get path to the annotations SQLite database
- [`save_annotations_db()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/save_annotations_db.md)
  : Save annotations to the SQLite database
- [`load_annotations_db()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/load_annotations_db.md)
  : Load annotations from the SQLite database
- [`list_annotated_samples_db()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/list_annotated_samples_db.md)
  : List samples with annotations in the database
- [`update_annotator()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/update_annotator.md)
  : Update the annotator name for one or more samples
- [`import_mat_to_db()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/import_mat_to_db.md)
  : Import a .mat annotation file into the SQLite database
- [`import_all_mat_to_db()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/import_all_mat_to_db.md)
  : Bulk import .mat annotation files into the SQLite database
- [`export_db_to_mat()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/export_db_to_mat.md)
  : Export annotations from SQLite to a .mat file
- [`export_all_db_to_mat()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/export_all_db_to_mat.md)
  : Bulk export all annotated samples from SQLite to .mat files
- [`export_db_to_png()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/export_db_to_png.md)
  : Export annotated images from SQLite to class-organized PNG folders
- [`export_all_db_to_png()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/export_all_db_to_png.md)
  : Bulk export all annotated samples from SQLite to class-organized
  PNGs

## File Index Cache

Functions for managing the file index cache for faster startup

- [`get_file_index_path()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/get_file_index_path.md)
  : Get path to file index cache
- [`load_file_index()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/load_file_index.md)
  : Load file index from disk cache
- [`save_file_index()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/save_file_index.md)
  : Save file index to disk cache
- [`rescan_file_index()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/rescan_file_index.md)
  : Rescan folders and rebuild the file index cache

## Utilities

Helper functions for IFCB data processing

- [`get_sample_paths()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/get_sample_paths.md)
  : Get sample paths from sample name
- [`read_roi_dimensions()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/read_roi_dimensions.md)
  : Read ROI dimensions from ADC file
- [`is_valid_sample_name()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/is_valid_sample_name.md)
  : Validate IFCB sample name format
- [`sanitize_string()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/sanitize_string.md)
  : Sanitize string for safe use in HTML/file paths
- [`create_empty_changes_log()`](https://europeanifcbgroup.github.io/ClassiPyR/reference/create_empty_changes_log.md)
  : Create empty changes log data frame

# Articles

### All vignettes

- [Class List
  Management](https://europeanifcbgroup.github.io/ClassiPyR/articles/class-management.md):
- [FAQ &
  Troubleshooting](https://europeanifcbgroup.github.io/ClassiPyR/articles/faq.md):
- [Getting
  Started](https://europeanifcbgroup.github.io/ClassiPyR/articles/getting-started.md):
- [User
  Guide](https://europeanifcbgroup.github.io/ClassiPyR/articles/user-guide.md):
